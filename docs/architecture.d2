sequence: {
  shape: sequence_diagram

  mf_extension: "Browser\nExtension"
  ex_confluence: Confluence
  j_d2_server: "D2\nServer"

  # Page load (once)
  mf_extension -> ex_confluence: detect macros
  ex_confluence -> mf_extension: code + params

  # Edit loop
  edit: {
    label: "loop [editing]"
    mf_extension -> j_d2_server: "POST /svg"
    j_d2_server -> mf_extension: SVG
  }

  # Save (view mode)
  mf_extension -> ex_confluence: "PUT storage"
  ex_confluence -> mf_extension: 200

  # Save (edit mode)
  mf_extension -> mf_extension: "update\nTinyMCE DOM"

  # Macro render (without extension)
  render: {
    label: "loop [page view]"
    ex_confluence -> j_d2_server: "fetch diagram"
    j_d2_server -> ex_confluence: "SVG / PNG"
  }
}
