sequence: {
  shape: sequence_diagram

  ext: Browser Extension
  confluence: Confluence
  d2server: D2 Server

  # Page load
  ext -> confluence: detect D2 macros
  confluence -> ext: macro code + params

  # Edit
  ext -> d2server: POST /svg (live preview)
  d2server -> ext: SVG

  # Save (view mode)
  ext -> confluence: PUT storage (REST API)
  confluence -> ext: 200 OK

  # Save (edit mode)
  ext -> ext: update TinyMCE DOM

  # Without extension
  confluence -> d2server: fetch diagram
  d2server -> confluence: SVG / PNG
}
